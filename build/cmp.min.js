"use strict";function _objectSpread(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},i=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),i.forEach(function(t){_defineProperty(e,t,a[t])})}return e}function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}!function(){var e=function(){function e(t){_classCallCheck(this,e),this._musics=t,this._fakePlayer=$(".cmp-player"),this._$playBtn=this._fakePlayer.find(".play-btn"),this._$progressBar=this._fakePlayer.find(".progress-bar"),this._$time=this._fakePlayer.find(".time"),this._$volumeWrapper=this._fakePlayer.find(".volume-wrapper"),this._$volumeInput=this._fakePlayer.find(".volume-input"),this._currentMusic=0,this._currentVolume=1,this.init()}return _createClass(e,[{key:"_createPlayer",value:function(){var e=document.createElement("audio");e.src=this._musics[this._currentMusic].mp3,e.preload="none",e.volume=this._currentVolume,this._player=e}},{key:"_musicEnded",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._fakePlayer.removeClass("playing"),this._resetProgressBar(),this._currentMusic++,this._currentMusic>=this._musics.length&&(this._currentMusic=0),$(document).trigger("cmp-media-end",[this._currentMusic,e]),this._makePlayer()}},{key:"_initPlayerListeners",value:function(){var e=this;$(this._player).on("timeupdate",function(){e._updateTime(e._player.currentTime,e._player.duration),e._updateProgressBar(e._player.currentTime,e._player.duration)}),$(this._player).on("play pause",function(){return e._isPlaying()?e._fakePlayer.addClass("playing"):e._fakePlayer.removeClass("playing")}),$(this._player).on("ended",function(){return e._musicEnded()}),$(this._player).on("loadstart",function(){var t=e._player.play();null!==t&&t.catch(function(){return e._makePlayer()})}),$(this._player).on("error",function(){navigator.onLine&&e._musicEnded(!0)})}},{key:"_makePlayer",value:function(){this._musics.length?($(this._player).off("timeupdate"),$(this._player).off("play pause"),$(this._player).off("ended"),$(this._player).off("canplaythrough"),this._createPlayer(),this._initPlayerListeners()):$(this._fakePlayer).html('<span class="error-msg">Nenhuma música detectada na lista atual.</span>')}},{key:"_initFakePlayerActions",value:function(){var e=this;this._$playBtn.on("click",function(){return e._isPlaying()?e._player.pause():e._player.play()}),this._$volumeWrapper.on("click",function(t){$(t.target).hasClass("volume-wrapper")&&e._$volumeWrapper.toggleClass("active")}),this._$volumeInput.on("input",function(){return e.setVolume(e._$volumeInput.val()/10)})}},{key:"_isPlaying",value:function(){return!this._player.paused}},{key:"_resetProgressBar",value:function(){this._$progressBar.css("transform","scaleX(0)")}},{key:"_updateProgressBar",value:function(e,t){this._$progressBar.css("transform","scaleX(".concat(Math.floor(e)/Math.floor(t),")"))}},{key:"_updateTime",value:function(e,t){var a=function(e){return e<10?"0"+e:e},i=function(e){var t=parseInt(e%60),i=parseInt(e/60%60);return a(i)+":"+a(t)};this._$time.text(i(e)+" / "+i(t))}},{key:"init",value:function(){var e=this;$(window).on("offline",function(){return e._fakePlayer.addClass("offline")}),$(window).on("online",function(){e._fakePlayer.removeClass("offline");var t=e._player.play();null!==t&&t.catch(function(){return e._makePlayer()})}),this._initFakePlayerActions(),this._makePlayer()}},{key:"getVolume",value:function(){return this._currentVolume}},{key:"setVolume",value:function(e){this._currentVolume=e,this._player.volume=this._currentVolume,this._$volumeInput.val(10*e)}}]),e}(),t=function(){function e(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,e),this._player={},this._videos=t,this.options=a,this._actualVideo=0,this._isPlaying=!1,this._fakePlayer=$(".cmp-player"),this._$playBtn=this._fakePlayer.find(".play-btn"),this._$progressBar=this._fakePlayer.find(".progress-bar"),this._$time=this._fakePlayer.find(".time"),this._$volumeWrapper=this._fakePlayer.find(".volume-wrapper"),this._$volumeInput=this._fakePlayer.find(".volume-input"),this._$expandBtn=this._fakePlayer.find(".expand-button"),this.init()}return _createClass(e,[{key:"init",value:function(){var e=this;if(this._videos.length){var t=document.createElement("script"),a=document.getElementsByTagName("script")[0];t.src="https://www.youtube.com/iframe_api",a.parentNode.insertBefore(t,a),window.onYouTubeIframeAPIReady=function(){var t=_objectSpread({width:$("body").width(),height:600,playerVars:{autoplay:0,cc_load_policy:0,controls:0,disablekb:1,enablejsapi:1,iv_load_policy:3,modestbranding:1,rel:0,showinfo:0},events:{onReady:i,onStateChange:n,onError:r}},e.options);e._player=new YT.Player("cvp-player",t),e._initFakePlayerActions()};var i=function(){var t=e._videos.map(function(t){return e._validaYoutube(t.link)});e._player.loadPlaylist(t),e._player.setLoop(!0),e._isPlaying=!0,setInterval(function(){e._updateTime(e._player.getCurrentTime(),e._player.getDuration()),e._updateProgressBar(e._player.getCurrentTime(),e._player.getDuration())},1e3)},n=function(t){e._isPlaying=!0,e._fakePlayer.addClass("playing"),2===t.data&&(e._isPlaying=!1,e._fakePlayer.removeClass("playing")),e._player.getPlaylistIndex()!==e._actualVideo&&(e._actualVideo=e._player.getPlaylistIndex(),e._videoChange())},r=function(){e._videoChange(!0),e._player.nextVideo()}}else $(this._fakePlayer).html('<span class="error-msg">Nenhuma música detectada na lista atual.</span>')}},{key:"_initFakePlayerActions",value:function(){var e=this;this._$playBtn.on("click",function(){return e._isPlaying?e._player.pauseVideo():e._player.playVideo()}),this._$volumeWrapper.on("click",function(t){$(t.target).hasClass("volume-wrapper")&&e._$volumeWrapper.toggleClass("active")}),this._$volumeInput.on("input",function(){return e.setVolume(e._$volumeInput.val()/10)}),this._$expandBtn.on("click",function(){var t=e._fakePlayer.parent()[0];document.fullscreen||document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():t.webkitExitFullscreen&&document.webkitExitFullscreen():t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()})}},{key:"getVolume",value:function(){return this._player.getVolume()}},{key:"setVolume",value:function(e){this._player.setVolume(100*e)}},{key:"_validaYoutube",value:function(e){var t=/(?:youtube\.com\/\S*(?:(?:\/e(?:mbed))?\/|watch\?(?:\S*?&?v\=))|youtu\.be\/)([a-zA-Z0-9_-]{6,11})/g.exec(e);return!(!t||11!==t[1].length)&&t[1]}},{key:"_videoChange",value:function(e){$(document).trigger("cmp-media-end",[this._player.getPlaylistIndex(),e])}},{key:"_updateProgressBar",value:function(e,t){this._$progressBar.css("transform","scaleX(".concat(Math.ceil(e)/Math.ceil(t),")"))}},{key:"_updateTime",value:function(e,t){var a=function(e){return e<10?"0"+e:e},i=function(e){var t=parseInt(Math.ceil(e)%60),i=parseInt(Math.ceil(e)/60%60);return a(i)+":"+a(t)};this._$time.text(i(e)+" / "+i(t))}}]),e}(),a=function(){function e(t){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];_classCallCheck(this,e),this._mediaList=t,this.isVideo=a,this._wrapper=$(".cml-music-list"),this.init()}return _createClass(e,[{key:"init",value:function(){var e=this;if(this._mediaList.length){var t=this._mediaList.map(function(t,a){if("comercial"!==t.typemedia&&"vinheta"!==t.typemedia)return'<li class="music-item '.concat(0===a?"active":"",'" \n                            data-music="').concat(a,'">').concat(e.isVideo?t.title:t.track,"</li>")}).join("");$(document).on("cmp-media-end",function(t,a,i){i&&e._wrapper.find(".music-item.active").addClass("error"),e._wrapper.find(".music-item").removeClass("active"),e._wrapper.find(".music-item[data-music=".concat(a,"]")).addClass("active"),e._scrollToMusic()}),this._wrapper.html(t)}}},{key:"_scrollToMusic",value:function(){var e=this._wrapper.find(".music-item.active");if(e.length){var t=e.offset().top,a=this._wrapper.offset().top,i=Number(t)-Number(a);this._wrapper.animate({scrollTop:i},"slow")}}}]),e}();"undefined"!=typeof exports?(exports.CeicomMediaPlayer=e,exports.CeicomVideoPlayer=t,exports.CeicomMediaList=a):(window.CeicomMediaPlayer=e,window.CeicomVideoPlayer=t,window.CeicomMediaList=a)}("undefined"!=typeof global&&global);