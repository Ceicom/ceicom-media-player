"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}!function(){var e=function(){function e(t){_classCallCheck(this,e),this._musics=t,this._fakePlayer=$(".cmp-player"),this._$playBtn=this._fakePlayer.find(".play-btn"),this._$progressBar=this._fakePlayer.find(".progress-bar"),this._$time=this._fakePlayer.find(".time"),this._$volumeWrapper=this._fakePlayer.find(".volume-wrapper"),this._$volumeInput=this._fakePlayer.find(".volume-input"),this._currentMusic=0,this._currentVolume=1,this.init()}return _createClass(e,[{key:"_createPlayer",value:function(){var e=document.createElement("audio");e.src=this._musics[this._currentMusic].mp3,e.preload="none",e.volume=this._currentVolume,this._player=e}},{key:"_musicEnded",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._fakePlayer.removeClass("playing"),this._resetProgressBar(),this._currentMusic++,this._currentMusic>=this._musics.length&&(this._currentMusic=0),$(document).trigger("cmp-music-end",[this._currentMusic,e]),this._makePlayer()}},{key:"_initPlayerListeners",value:function(){var e=this;$(this._player).on("timeupdate",function(){e._updateTime(e._player.currentTime,e._player.duration),e._updateProgressBar(e._player.currentTime,e._player.duration)}),$(this._player).on("play pause",function(){return e._isPlaying()?e._fakePlayer.addClass("playing"):e._fakePlayer.removeClass("playing")}),$(this._player).on("ended",function(){return e._musicEnded()}),$(this._player).on("loadstart",function(){var t=e._player.play();null!==t&&t.catch(function(){return e._makePlayer()})}),$(this._player).on("error",function(){navigator.onLine&&e._musicEnded(!0)})}},{key:"_makePlayer",value:function(){this._musics.length?($(this._player).off("timeupdate"),$(this._player).off("play pause"),$(this._player).off("ended"),$(this._player).off("canplaythrough"),this._createPlayer(),this._initPlayerListeners()):$(this._fakePlayer).html('<span class="error-msg">Nenhuma m√∫sica detectada na lista atual.</span>')}},{key:"_initFakePlayerActions",value:function(){var e=this;this._$playBtn.on("click",function(){return e._isPlaying()?e._player.pause():e._player.play()}),this._$volumeWrapper.on("click",function(t){$(t.target).hasClass("volume-wrapper")&&e._$volumeWrapper.toggleClass("active")}),this._$volumeInput.on("input",function(){return e.setVolume(e._$volumeInput.val()/10)})}},{key:"_isPlaying",value:function(){return!this._player.paused}},{key:"_resetProgressBar",value:function(){this._$progressBar.css("transform","scaleX(0)")}},{key:"_updateProgressBar",value:function(e,t){this._$progressBar.css("transform","scaleX(".concat(Math.floor(e)/Math.floor(t),")"))}},{key:"_updateTime",value:function(e,t){var i=function(e){return e<10?"0"+e:e},a=function(e){var t=parseInt(e%60),a=parseInt(e/60%60);return i(a)+":"+i(t)};this._$time.text(a(e)+" / "+a(t))}},{key:"init",value:function(){var e=this;$(window).on("offline",function(){return e._fakePlayer.addClass("offline")}),$(window).on("online",function(){e._fakePlayer.removeClass("offline");var t=e._player.play();null!==t&&t.catch(function(){return e._makePlayer()})}),this._initFakePlayerActions(),this._makePlayer()}},{key:"getVolume",value:function(){return this._currentVolume}},{key:"setVolume",value:function(e){this._currentVolume=e,this._player.volume=this._currentVolume,this._$volumeInput.val(10*e)}}]),e}(),t=function(){function e(t){_classCallCheck(this,e),this._musics=t,this._wrapper=$(".cml-music-list"),this.init()}return _createClass(e,[{key:"init",value:function(){var e=this;if(this._musics.length){var t=this._musics.map(function(e,t){if("comercial"!==e.typemedia&&"vinheta"!==e.typemedia)return'<li class="music-item '.concat(0===t?"active":"",'" data-music="').concat(t,'">').concat(e.track,"</li>")}).join("");$(document).on("cmp-music-end",function(t,i,a){a&&e._wrapper.find(".music-item.active").addClass("error"),e._wrapper.find(".music-item").removeClass("active"),e._wrapper.find(".music-item[data-music=".concat(i,"]")).addClass("active"),e._scrollToMusic()}),this._wrapper.html(t)}}},{key:"_scrollToMusic",value:function(){var e=this._wrapper.find(".music-item.active");if(e.length){var t=e.offset().top,i=this._wrapper.offset().top,a=Number(t)-Number(i);this._wrapper.animate({scrollTop:a},"slow")}}}]),e}();"undefined"!=typeof exports?(exports.CeicomMediaPlayer=e,exports.CeicomMediaList=t):(window.CeicomMediaPlayer=e,window.CeicomMediaList=t)}("undefined"!=typeof global&&global);